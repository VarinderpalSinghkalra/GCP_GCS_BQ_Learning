openapi: 3.0.0

info:
  title: Access Request Submission API
  version: "1.0.0"
  description: >
    Tool for submitting user access requests.
    Persists the request in Firestore and triggers
    asynchronous lifecycle automation via Cloud Tasks.
    Always returns HTTP 200 with a structured response.
    Designed for Conversational Agents / Vertex AI tools.

servers:
  - url: https://us-central1-data-engineering-479617.cloudfunctions.net

paths:
  /submit_access_request:
    post:
      summary: Submit an access provisioning request
      operationId: submitAccessRequest
      description: >
        Creates a new access request and stores it in Firestore.
        The lifecycle (new → assigned → in_progress → completed)
        is managed asynchronously by Cloud Tasks.

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - resource
                - access_level
              properties:
                user_id:
                  type: string
                  description: Unique identifier of the requesting user
                  example: emp_100
                resource:
                  type: string
                  description: Resource for which access is requested
                  example: BigQuery Dataset
                access_level:
                  type: string
                  description: Level of access requested
                  example: read
                justification:
                  type: string
                  description: Optional justification for access
                  example: Reporting access needed

      responses:
        "200":
          description: Submission result
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  request_id:
                    type: string
                    description: Generated access request ID
                    example: AR-8F3A91C2
                  status:
                    type: string
                    description: created | failed
                    example: created