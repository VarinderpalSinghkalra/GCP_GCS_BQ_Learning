openapi: 3.0.0

info:
  title: Access Request Provisioning API
  version: "1.0.0"
  description: >
    Tool for creating and tracking user access requests.
    Backed by a Cloud Function (Gen2) with Firestore persistence
    and Cloud Tasks–driven lifecycle automation.
    Always returns HTTP 200 with a structured JSON response.
    Designed for use with Vertex AI / Conversational Agents tools.

servers:
  - url: https://us-central1-data-engineering-479617.cloudfunctions.net

paths:
  /submit_access_request:
    post:
      summary: Create an access provisioning request
      operationId: submitAccessRequest
      description: >
        Creates a new access request, stores it in Firestore,
        and automatically progresses the request lifecycle
        (new → assigned → in_progress → completed) within 3 minutes
        using Cloud Tasks.

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - resource
                - access_level
              properties:
                user_id:
                  type: string
                  description: Unique identifier of the requesting user
                  example: emp_100
                resource:
                  type: string
                  description: Resource for which access is requested
                  example: BigQuery Dataset
                access_level:
                  type: string
                  description: Level of access requested
                  example: read
                justification:
                  type: string
                  description: Optional justification for access
                  example: Reporting access needed

      responses:
        "200":
          description: Tool response (success or validation failure)
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  request_id:
                    type: string
                    description: Generated access request identifier
                    example: AR-8F3A91C2
                  status:
                    type: string
                    description: created | failed
                    example: created

  /get_access_request_status:
    get:
      summary: Get access request status
      operationId: getAccessRequestStatus
      description: >
        Fetches the current status of an access request
        from Firestore. Designed to be agent-friendly and
        always return HTTP 200.

      parameters:
        - name: request_id
          in: query
          required: true
          schema:
            type: string
          description: Access request identifier
          example: AR-8F3A91C2

      responses:
        "200":
          description: Current access request status
          content:
            application/json:
              schema:
                type: object
                required:
                  - request_id
                  - status
                properties:
                  request_id:
                    type: string
                    example: AR-8F3A91C2
                  status:
                    type: string
                    description: new | assigned | in_progress | completed | not_found | failed
                    example: in_progress
                  resource:
                    type: string
                    example: BigQuery Dataset
                  access_level:
                    type: string
                    example: read
                  updated_at:
                    type: string
                    nullable: true
                    description: ISO-8601 timestamp of last status update
                    example: "2026-01-19T06:45:12.123Z"
