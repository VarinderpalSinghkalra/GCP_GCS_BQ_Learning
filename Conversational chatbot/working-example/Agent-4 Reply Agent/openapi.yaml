openapi: 3.0.0

info:
  title: Issue Management API
  version: "1.1.0"
  description: >
    Tool-backed Issue Management API for Conversational Agents.
    Supports issue creation, automated lifecycle management,
    and real-time status queries.
    Backed by Cloud Functions (Gen2), Firestore, Pub/Sub, and Gemini.
    Always returns HTTP 200 with structured JSON.

servers:
  - url: https://submit-issue-277069041958.us-central1.run.app
    description: Create Issue API
  - url: https://get-issue-status-277069041958.us-central1.run.app
    description: Get Issue Status API

paths:
  /:
    post:
      summary: Create a support issue
      operationId: createIssue
      description: >
        Creates a new support issue, stores it in Firestore,
        computes SLA based on priority, and returns an assistant
        acknowledgement generated by Gemini.

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reporter_id
                - issue
              properties:
                reporter_id:
                  type: string
                  description: Unique identifier of the reporting user
                  example: deployment-test
                issue:
                  type: string
                  minLength: 5
                  description: Description of the reported issue
                  example: Cloud Run deployment verification
                priority:
                  type: string
                  enum: [P1, P2, P3, P4]
                  default: P3
                  description: Issue priority (defaults to P3 if missing)

      responses:
        "200":
          description: Tool response (success or validation failure)
          content:
            application/json:
              schema:
                type: object
                required:
                  - issue_id
                  - status
                  - assistant_reply
                properties:
                  issue_id:
                    type: string
                    example: INC-2303565C
                  status:
                    type: string
                    example: created
                  assistant_reply:
                    type: string
                    example: Your issue has been logged.

  /status:
    get:
      summary: Get current issue status
      operationId: getIssueStatus
      description: >
        Fetches the current lifecycle status of an issue.
        This endpoint is designed for Conversational Agents
        to answer real-time user queries.

      parameters:
        - name: issue_id
          in: query
          required: true
          schema:
            type: string
          description: Issue identifier
          example: INC-2303565C

      responses:
        "200":
          description: Current issue status
          content:
            application/json:
              schema:
                type: object
                required:
                  - issue_id
                  - current_status
                properties:
                  issue_id:
                    type: string
                    example: INC-2303565C
                  current_status:
                    type: string
                    enum: [new, assigned, in_progress, completed]
                    example: in_progress
                  priority:
                    type: string
                    example: P3
                  last_updated_at:
                    type: string
                    format: date-time
                    example: 2026-01-08T14:10:12Z
